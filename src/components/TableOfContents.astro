---
import type { MarkdownHeading } from "astro";

interface Props {
    headings: MarkdownHeading[];
}

const { headings } = Astro.props;

// Filter headings to only show h2 and h3
const filteredHeadings = headings.filter(
    (heading) => heading.depth >= 2 && heading.depth <= 3,
);
---

<nav class="toc-container">
    <h2
        class="text-sm font-bold text-gray-900 dark:text-white uppercase tracking-wider mb-4 pl-4"
    >
        Dans cet article
    </h2>
    <ul class="space-y-1 text-sm border-l border-gray-200 dark:border-gray-800">
        {
            filteredHeadings.map((heading) => (
                <li>
                    <a
                        href={`#${heading.slug}`}
                        class={`block py-1.5 pl-4 border-l-2 -ml-[1px] transition-colors duration-200
              ${
                  heading.depth === 2
                      ? "text-gray-600 dark:text-gray-400 hover:text-quartz dark:hover:text-quartz-light hover:border-quartz dark:hover:border-quartz-light border-transparent"
                      : "text-gray-500 dark:text-gray-500 hover:text-quartz dark:hover:text-quartz-light ml-2 border-transparent"
              }
            `}
                        data-toc-link
                    >
                        {heading.text}
                    </a>
                </li>
            ))
        }
    </ul>
</nav>

<script>
    // Script for active state highlighting
    const observer = new IntersectionObserver(
        (entries) => {
            entries.forEach((entry) => {
                const id = entry.target.getAttribute("id");
                const link = document.querySelector(`a[href="#${id}"]`);

                if (entry.isIntersecting) {
                    document
                        .querySelectorAll("[data-toc-link]")
                        .forEach((l) => {
                            l.classList.remove(
                                "text-quartz",
                                "dark:text-quartz-light",
                                "border-quartz",
                                "dark:border-quartz-light",
                                "font-medium",
                            );
                            l.classList.add("border-transparent");
                        });

                    if (link) {
                        link.classList.remove(
                            "border-transparent",
                            "text-gray-600",
                            "dark:text-gray-400",
                            "text-gray-500",
                        );
                        link.classList.add(
                            "text-quartz",
                            "dark:text-quartz-light",
                            "border-quartz",
                            "dark:border-quartz-light",
                            "font-medium",
                        );
                    }
                }
            });
        },
        { rootMargin: "-100px 0px -66% 0px" },
    );

    document.querySelectorAll("h2, h3").forEach((heading) => {
        observer.observe(heading);
    });
</script>

<style>
    .toc-container {
        max-height: calc(100vh - 8rem);
        overflow-y: auto;
    }

    /* Custom scrollbar */
    .toc-container::-webkit-scrollbar {
        width: 4px;
    }
    .toc-container::-webkit-scrollbar-track {
        background: transparent;
    }
    .toc-container::-webkit-scrollbar-thumb {
        background: rgba(156, 163, 175, 0.3);
        border-radius: 2px;
    }
</style>
